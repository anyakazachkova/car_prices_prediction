# Car_prices_prediction
**HW1 ML 2022, Kazachkova Anna**

## Что было сделано?
### 1. **EDA данных:**
* Посмотрела основные статистики данных.
* Обработка пропусков и дубликатов.
* Форматирование данных (числовые переменные переведены из string к int или float, столбец torque обработан как два столбца с учетом разных едеиниц измерения).
* Визуализации: распределения, боксплоты, корреляции.
### 2. **Обучение моделей только с числовыми признаками:**
* **Масштабирование признаков** StandardScaler.
* Простая линейная регрессия (R^2: 0.6066681619626096, MSE: 226673200901.2861).
* Lasso-регрессия с дефолтными параметрами (R^2: 0.6056668075054712, MSE: 226673979481.92664) => веса не были занулены.
* Lasso-регрессия с перебором значений для alpha (R^2: 0.6056668075054712, MSE: 226673979481.92664) => оптимальным значением оказалось alpha=1, и результаты вышли те же.
* Elastic-регрессия с перебором значений для alpha и l1 (R^2: 0.579064794459751, MSE: 241965576218.07303).
### 3. **Обучение моделей с добавлением категориальных признаков:**
* Добавила **категориальные признаки**, причем seats тоже сделала категориальным признаком.
* **Кодирование OneHotEncoder** для категориальных переменных, причем первый столбец был удален для избежания мультиколлинеарности.
* Ridge-регрессия с перебором значений для alpha (R^2: 0.6446616000379763, MSE: 204258659213.0459).
* Вот так поулчилось немного улучшить качество модели.
### 4. **Feature Engineering:**
* Посмотрела на выбросы, не придумала как лучше с ними поступить.
* Сделала **дамми-переменные для марок машин**.
* Добавила **новые признаки** на основе наблюдений за попарными распределениями: year^2, km_driven^2, engine^2, max_power^2, engine_to_capacity.
* Elastic-регрессия с перебором значений для alpha и l1 (R^2: 0.790866435313641, MSE: 120215944924.17894).
* Посчитала **кастомную метрику** для самой последней модели: доля предсказаний, отклоняющихся от верных ответов не больше, чем на 10%. Получилось не очень много: **28,9%**.
### 5. **Сервис на FastApi для модели:**
* За основу я взяла самую последнюю модель, т.к. она показала наилучшее качество.
* В сервисе сделала **две функции**: сделать предсказание цены 1) для одной машины 2) для списка машин.
* В него надо еще добавить функцию загрузки csv-файла и выгрузки файла с добавлением предсказанных цен. Пока все работает только с json-данными.
* Хотелось бы еще сделать для его работы интерфейс.
* Посмотрела, как работает сервис. Вроде бы предсказания довольно реалистичные. <br>
*predict_item:*
![image](https://user-images.githubusercontent.com/61575714/205256721-194bf1a5-5b5e-41fa-875e-acac5dac06e0.png)
![image](https://user-images.githubusercontent.com/61575714/205256764-20b2b869-739c-428b-84db-38ac4bc7fbe1.png)
*predict_items:*
![image](https://user-images.githubusercontent.com/61575714/205256451-2f40ca46-5b2c-4fe9-952c-be397b59b8a5.png)
![image](https://user-images.githubusercontent.com/61575714/205256577-a1ea630e-809b-46b4-a314-1d26d96c91c8.png)
## Какие основные результаты?
Главный результат - это последняя Elastic-регрессия, которая обучена с добавлением новых признаков. Наибольший буст в качестве дали как раз признаки с квадратичной зависимостью и дамми-переменные для марок машин. Также удобно, что через сервис на FastApi можно быстро посмотреть результаты работы модели, не вчитываюсь в код.
## Что хотелось бы еще сделать?
* Поработать с другим способом заполнения пропусков.
* Обработать выбросы в данных.
* Найти правило, по которому можно было бы сделать модель с порогами, так как кажется, что как раз здесь это бы сильно помогло.
* Попрбовать логарифмировать переменные torque_nm и max_torque_rpm.
* Попрбовать другое кодирование: например, для числа владельцев можно было бы попробовать label encoding вместо дамми-переменных.
* Добавить сервису удобный интерфейс.
